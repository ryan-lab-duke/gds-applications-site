
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Network data analysis &#8212; Geospatial Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/unit1/lecture-3';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Assignment 3" href="../../labs/week3/assignment3.html" />
    <link rel="prev" title="Activity 2" href="../../activities/week2/activity-02.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/nsoe-logo.png" class="logo__image only-light" alt="Geospatial Data Science - Home"/>
    <img src="../../_static/nsoe-logo.png" class="logo__image only-dark pst-js-only" alt="Geospatial Data Science - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome to Geospatial Data Science!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../course-info/general-info.html">General information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/schedule.html">Schedule (for Fall 2025)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/github.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/format.html">Formatting answers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/final-project.html">Final projects</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture-1.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week1/assignment1.html">Assignment 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../activities/week1/activity-01.html">Activity 1</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture-2.html">Vector data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week2/assignment2.html">Assignment 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../activities/week2/activity-02.html">Activity 2</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Network data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week3/assignment3.html">Assignment 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../activities/week3/activity-03.html">Activity 3</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture-4a.html">Gridded data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-4b.html">Climate data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week4/assignment4.html">Assignment 4</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../unit2/lecture-5.html">Machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week5/assignment5.html">Assignment 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week5/project-ideas.html">Project ideas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../unit3/lecture-6.html">Code management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week6/assignment6.html">Assignment 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labs/week6/activity6.html">Make a README</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../unit3/lecture-7.html">Data access</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 8</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../unit3/lecture-8.html">Automating raster analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 9</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../unit4/lecture-9a.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unit4/lecture-9b.html">Maps with data</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ryan-lab-duke/gds-applications-site" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ryan-lab-duke/gds-applications-site/issues/new?title=Issue%20on%20page%20%2Flectures/unit1/lecture-3.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/lectures/unit1/lecture-3.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Network data analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#openstreetmap">OpenStreetMap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-data">Network data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-network-data">Types of network data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx"><code class="docutils literal notranslate"><span class="pre">NetworkX</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#osmnx"><code class="docutils literal notranslate"><span class="pre">OSMnx</span> </code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-osm-data">Retrieve OSM data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#produce-a-graph-or-network">Produce a graph (or network)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproject-network">Reproject network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-points-of-interest">Define points of interest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-shortest-path-between-points">Find the shortest path between points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-distance-to-many-cafes">Find the distance to many cafes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isochrones">Isochrones</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-and-node-attributes">Edge and node attributes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nodes">Nodes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edges">Edges</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-an-edge-attribute">Add an edge attribute</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-all-nodes-within-given-radius">Find all nodes within given radius</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#produce-isochrone-map">Produce isochrone map</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isochrone-polygons">Isochrone polygons</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgments">Acknowledgments</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="network-data-analysis">
<h1>Network data analysis<a class="headerlink" href="#network-data-analysis" title="Link to this heading">#</a></h1>
<p>Network data is a powerful way to model and analyze interconnected systems. In Earth Sciences, researchers use network data to:</p>
<ul class="simple">
<li><p>Measure accessibility to critical services</p></li>
<li><p>Identify vulnerable links in a network</p></li>
<li><p>Simulate how natural hazards disrupt mobility</p></li>
<li><p>Evaluate evacuation routes or supply chain delays</p></li>
</ul>
<p>In this lecture we will use the Python library <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code> and <code class="docutils literal notranslate"><span class="pre">NetworkX</span></code> packages to conduct network analysis to answer a more trivial question: how many cafes can we walk to in 35 minutes from Grainger Hall? By investigating this question, we will learn how to (1) download data from <strong>OpenStreetMap (OSM)</strong>, (2) interpret the primary components of a <strong>graph</strong>, and (3) perform some basic network data analysis that could be applied to other types of <strong>relational data</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">osmnx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ox</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;USE_PYGEOS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">MultiLineString</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">folium</span>
</pre></div>
</div>
</div>
</div>
<section id="openstreetmap">
<h2>OpenStreetMap<a class="headerlink" href="#openstreetmap" title="Link to this heading">#</a></h2>
<p>OpenStreetMap (OSM) is a project that is building a free map of the whole world. Thousands of members are teamed to create an accurate, detailed and up-to-date map that is as good or better than commercial products. Like Wikipedia, OpenStreetMap benefits from the ongoing input of thousands of people around the world.</p>
<ul class="simple">
<li><p>Everyone can contribute and add objects.</p></li>
<li><p>More than eight million participant accounts with more than 16,000 (and rapidly growing) of those highly active members in multiple languages.</p></li>
<li><p>Anyone can access the OSM map data for free, and it already is being used in many applications.</p></li>
<li><p>There already is full coverage in most urban areas and data is used in many commercial applications.</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/osm.png"><img alt="../../_images/osm.png" class="align-center" src="../../_images/osm.png" style="width: 800px;" /></a>
</section>
<section id="network-data">
<h2>Network data<a class="headerlink" href="#network-data" title="Link to this heading">#</a></h2>
<p>Most geospatial data is represented in one of two spatial models, <strong>vector-based</strong>, i.e. points, lines and polygons, or <strong>raster-based</strong>, i.e. cells of a continuous grid surface. The vector data model is <strong>feature-oriented</strong>, as it represents space as a series of discrete entities.</p>
<p>Network data represents <strong>interconnections</strong> between <strong>features</strong>. Almost everyone has needed a type of network analysis in their life.</p>
<p>For example:</p>
<ul class="simple">
<li><p>What is the shortest route to the beach?</p></li>
<li><p>Where should we build a hospital to best serve a community?</p></li>
<li><p>How can I optimize a package delivery route?</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/shortest_route.png"><img alt="../../_images/shortest_route.png" class="align-center" src="../../_images/shortest_route.png" style="width: 600px;" /></a>
</section>
<section id="types-of-network-data">
<h2>Types of network data<a class="headerlink" href="#types-of-network-data" title="Link to this heading">#</a></h2>
<p>In a network, each <strong>feature</strong> is represented by a <strong>node</strong> and <strong>connections</strong> between nodes are represented by <strong>edges</strong>. There are four main types of network diagram.</p>
<a class="reference internal image-reference" href="../../_images/network1.png"><img alt="../../_images/network1.png" class="align-center" src="../../_images/network1.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../../_images/network2.png"><img alt="../../_images/network2.png" class="align-center" src="../../_images/network2.png" style="width: 600px;" /></a>
</section>
<section id="networkx">
<h2><code class="docutils literal notranslate"><span class="pre">NetworkX</span></code><a class="headerlink" href="#networkx" title="Link to this heading">#</a></h2>
<a class="reference internal image-reference" href="../../_images/networkx.png"><img alt="../../_images/networkx.png" class="align-center" src="../../_images/networkx.png" style="width: 600px;" /></a>
</section>
<section id="osmnx">
<h2><code class="docutils literal notranslate"><span class="pre">OSMnx</span> </code><a class="headerlink" href="#osmnx" title="Link to this heading">#</a></h2>
<p>A Python package to retrieve, model, analyze, and visualize street <strong>networks</strong> from <strong>OpenStreetMap</strong>. Users can download and model walkable, drivable, or bikeable urban networks with a single line of Python code, and then easily analyze and visualize them.</p>
<a class="reference internal image-reference" href="../../_images/osmnx.png"><img alt="../../_images/osmnx.png" class="align-center" src="../../_images/osmnx.png" style="width: 800px;" /></a>
</section>
<section id="retrieve-osm-data">
<h2>Retrieve OSM data<a class="headerlink" href="#retrieve-osm-data" title="Link to this heading">#</a></h2>
<p>First we will retrieve all features labeled (or tagged) as <strong>buildings</strong> in Durham from OSM using <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify type of data</span>
<span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;building&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

<span class="c1"># Download building geometries from OSM</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">features_from_place</span><span class="p">(</span><span class="s1">&#39;Durham, NC, USA&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This produces a large <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> containing over 83,000 buildings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(83593, 254)
</pre></div>
</div>
</div>
</div>
<p>For the purposes of this assignment, we are only interested in <strong>cafes</strong> which are usually tagged as an <strong><code class="docutils literal notranslate"><span class="pre">amenity</span></code></strong> in OSM but sometimes can be tagged a <strong><code class="docutils literal notranslate"><span class="pre">shop</span></code></strong>. We can filter them using a string comparison.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter cafes and pastry shops</span>
<span class="n">cafes</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;amenity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cafe&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;shop&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pastry&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;shop&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bakery&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cafes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(15, 256)
</pre></div>
</div>
</div>
</div>
<p>We find that there are 15 cafes/bakeries in Durham. This could well be an underestimate since there could be cafes that were not tagged as amenities when mapped. But let’s keep moving forward and plot them.</p>
<p>The cafes are acually <strong>polygons</strong> so we will compute their <strong>centroids</strong> to make it simpler to plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get cafe centroids</span>
<span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">centroid</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">Polygon</span> <span class="k">else</span> <span class="p">(</span>
  <span class="n">x</span><span class="o">.</span><span class="n">centroid</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">MultiPolygon</span> <span class="k">else</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can visulize interactively using <code class="docutils literal notranslate"><span class="pre">folium</span></code>. Again don’t be too worried if you haven’t used this library, we will cover it in a future lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define center of map (i.e. Grainger Hall) and initial zoom level</span>
<span class="n">lat_lon</span> <span class="o">=</span> <span class="p">[</span><span class="mf">36.0046</span><span class="p">,</span> <span class="o">-</span><span class="mf">78.9426</span><span class="p">]</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">lat_lon</span><span class="p">,</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cafes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">my_string</span> <span class="o">=</span> <span class="n">cafes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">([</span><span class="n">cafes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cafes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">],</span>
                 <span class="n">popup</span><span class="o">=</span><span class="n">my_string</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Display map</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
    
        &lt;script&gt;
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        &lt;/script&gt;
    
    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;
    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;
    
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
            &lt;style&gt;
                #map_f81c42e82786365fe81fe67debe51ac5 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            &lt;/style&gt;
        
&lt;/head&gt;
&lt;body&gt;
    
    
            &lt;div class=&quot;folium-map&quot; id=&quot;map_f81c42e82786365fe81fe67debe51ac5&quot; &gt;&lt;/div&gt;
        
&lt;/body&gt;
&lt;script&gt;
    
    
            var map_f81c42e82786365fe81fe67debe51ac5 = L.map(
                &quot;map_f81c42e82786365fe81fe67debe51ac5&quot;,
                {
                    center: [36.0046, -78.9426],
                    crs: L.CRS.EPSG3857,
                    ...{
  &quot;zoom&quot;: 12,
  &quot;zoomControl&quot;: true,
  &quot;preferCanvas&quot;: false,
}

                }
            );

            

        
    
            var tile_layer_454ecf6a4bb56f531ca870957fad441e = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 19,
  &quot;maxNativeZoom&quot;: 19,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_454ecf6a4bb56f531ca870957fad441e.addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
            var marker_2e89f4632042e6f56c1448e4f7540c0d = L.marker(
                [36.00827795297206, -78.92183828698809],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_24618221f7460913b4167b8a91dc78e6 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_b498589f7b47b06ba56a80622b1c39b6 = $(`&lt;div id=&quot;html_b498589f7b47b06ba56a80622b1c39b6&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;9th Street Coffee and Juice Bar&lt;/div&gt;`)[0];
                popup_24618221f7460913b4167b8a91dc78e6.setContent(html_b498589f7b47b06ba56a80622b1c39b6);
            
        

        marker_2e89f4632042e6f56c1448e4f7540c0d.bindPopup(popup_24618221f7460913b4167b8a91dc78e6)
        ;

        
    
    
            var marker_dc8bafbbf07beb31af41c592f8efbf39 = L.marker(
                [36.030850559001685, -78.89727915053125],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_f17171bd75c2b67fb22f54b0065f1b89 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_8978ca4a515eb780b84b5ce4a59ddc0c = $(`&lt;div id=&quot;html_8978ca4a515eb780b84b5ce4a59ddc0c&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Sprout Cafe&lt;/div&gt;`)[0];
                popup_f17171bd75c2b67fb22f54b0065f1b89.setContent(html_8978ca4a515eb780b84b5ce4a59ddc0c);
            
        

        marker_dc8bafbbf07beb31af41c592f8efbf39.bindPopup(popup_f17171bd75c2b67fb22f54b0065f1b89)
        ;

        
    
    
            var marker_f8e5a70a6a13269552f74eefbc607376 = L.marker(
                [36.006366068108946, -78.92015310273744],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_904c103e44c0db1cfc68482db44a8761 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_8a6930440be58a2ed16cd824da9bb0f1 = $(`&lt;div id=&quot;html_8a6930440be58a2ed16cd824da9bb0f1&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Mad Hatter&#x27;s Bake Shop&lt;/div&gt;`)[0];
                popup_904c103e44c0db1cfc68482db44a8761.setContent(html_8a6930440be58a2ed16cd824da9bb0f1);
            
        

        marker_f8e5a70a6a13269552f74eefbc607376.bindPopup(popup_904c103e44c0db1cfc68482db44a8761)
        ;

        
    
    
            var marker_008a294d54ae28c9b24108beb5a0d15f = L.marker(
                [36.008017882303015, -78.92188228649684],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_705641088cf6ae8ceb89822670b17486 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_c3a41794bdd342dcda359ddc6b5dff27 = $(`&lt;div id=&quot;html_c3a41794bdd342dcda359ddc6b5dff27&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Francesca&#x27;s Dessert Cafe&lt;/div&gt;`)[0];
                popup_705641088cf6ae8ceb89822670b17486.setContent(html_c3a41794bdd342dcda359ddc6b5dff27);
            
        

        marker_008a294d54ae28c9b24108beb5a0d15f.bindPopup(popup_705641088cf6ae8ceb89822670b17486)
        ;

        
    
    
            var marker_8a075e505b0edbc964c9127e64d3fb9d = L.marker(
                [36.015375500000005, -78.93471660000002],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_d6cffa922d3abc421cb82a6418417d74 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_5c6b3fe217257371c104d55a32d5a63d = $(`&lt;div id=&quot;html_5c6b3fe217257371c104d55a32d5a63d&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Panaderia La Loma&lt;/div&gt;`)[0];
                popup_d6cffa922d3abc421cb82a6418417d74.setContent(html_5c6b3fe217257371c104d55a32d5a63d);
            
        

        marker_8a075e505b0edbc964c9127e64d3fb9d.bindPopup(popup_d6cffa922d3abc421cb82a6418417d74)
        ;

        
    
    
            var marker_be386f777caf5c20f97b247663777dd2 = L.marker(
                [36.00089295000001, -78.91104960000001],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_2f3ec135e381612705e074df04ee4d5b = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_fc5e09642217dee667df1d07c8a5904d = $(`&lt;div id=&quot;html_fc5e09642217dee667df1d07c8a5904d&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Miel Bon Bons I Fine Chocolate &amp; Macarons l Extraordinary Desserts&lt;/div&gt;`)[0];
                popup_2f3ec135e381612705e074df04ee4d5b.setContent(html_fc5e09642217dee667df1d07c8a5904d);
            
        

        marker_be386f777caf5c20f97b247663777dd2.bindPopup(popup_2f3ec135e381612705e074df04ee4d5b)
        ;

        
    
    
            var marker_4dcb18cd766d4436c388e679892f9494 = L.marker(
                [36.00397473564195, -78.90108628083604],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_a061babf4ffb28d6ee3c6da4a83f21dd = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_91b3be51007df9079f2e0fb8c11663a9 = $(`&lt;div id=&quot;html_91b3be51007df9079f2e0fb8c11663a9&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Cocoa Cinnamon&lt;/div&gt;`)[0];
                popup_a061babf4ffb28d6ee3c6da4a83f21dd.setContent(html_91b3be51007df9079f2e0fb8c11663a9);
            
        

        marker_4dcb18cd766d4436c388e679892f9494.bindPopup(popup_a061babf4ffb28d6ee3c6da4a83f21dd)
        ;

        
    
    
            var marker_451fd47479486d52860166a9cd2fd8cc = L.marker(
                [35.98907227689903, -78.88956919143183],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_3acbbf4027a1436b351cc6b2a3100c45 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_9f866949a6203fb7325b6a4cad502648 = $(`&lt;div id=&quot;html_9f866949a6203fb7325b6a4cad502648&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Nolia Family + Coffee&lt;/div&gt;`)[0];
                popup_3acbbf4027a1436b351cc6b2a3100c45.setContent(html_9f866949a6203fb7325b6a4cad502648);
            
        

        marker_451fd47479486d52860166a9cd2fd8cc.bindPopup(popup_3acbbf4027a1436b351cc6b2a3100c45)
        ;

        
    
    
            var marker_4fc8354e091351d37e19e1428b8b3e50 = L.marker(
                [36.05783059551391, -78.92942773631333],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_85ce432a3d3cc1921485afd4465bb6d4 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_dbfb66660e97118b979c7dd7e9608744 = $(`&lt;div id=&quot;html_dbfb66660e97118b979c7dd7e9608744&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Starbucks&lt;/div&gt;`)[0];
                popup_85ce432a3d3cc1921485afd4465bb6d4.setContent(html_dbfb66660e97118b979c7dd7e9608744);
            
        

        marker_4fc8354e091351d37e19e1428b8b3e50.bindPopup(popup_85ce432a3d3cc1921485afd4465bb6d4)
        ;

        
    
    
            var marker_bcf63ce0e5b2d30254bc34c08e790965 = L.marker(
                [35.98661943373909, -78.92843097874301],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_398625b30543e5d999fa15b2c761ed45 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_887fe26c26c501e3971e677eee5ebfef = $(`&lt;div id=&quot;html_887fe26c26c501e3971e677eee5ebfef&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Baby Scratch&lt;/div&gt;`)[0];
                popup_398625b30543e5d999fa15b2c761ed45.setContent(html_887fe26c26c501e3971e677eee5ebfef);
            
        

        marker_bcf63ce0e5b2d30254bc34c08e790965.bindPopup(popup_398625b30543e5d999fa15b2c761ed45)
        ;

        
    
    
            var marker_6256d4ff6b548a10ab9ccbbeddbf3099 = L.marker(
                [35.98648491076477, -78.92736663363871],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_88f339a0df71dbf8906f6e824fe5429b = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_ea5f38b5b83b9df9a888133e51799134 = $(`&lt;div id=&quot;html_ea5f38b5b83b9df9a888133e51799134&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Cocoa Cinnamon&lt;/div&gt;`)[0];
                popup_88f339a0df71dbf8906f6e824fe5429b.setContent(html_ea5f38b5b83b9df9a888133e51799134);
            
        

        marker_6256d4ff6b548a10ab9ccbbeddbf3099.bindPopup(popup_88f339a0df71dbf8906f6e824fe5429b)
        ;

        
    
    
            var marker_33dd543e981b99aea808a33de492eedd = L.marker(
                [35.899411916322705, -78.89714129970001],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_a9d9291123a3b0f3f5db4a0e1f468021 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_9c79b51f0084b2e61bc93a94df3d85dc = $(`&lt;div id=&quot;html_9c79b51f0084b2e61bc93a94df3d85dc&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Starbucks&lt;/div&gt;`)[0];
                popup_a9d9291123a3b0f3f5db4a0e1f468021.setContent(html_9c79b51f0084b2e61bc93a94df3d85dc);
            
        

        marker_33dd543e981b99aea808a33de492eedd.bindPopup(popup_a9d9291123a3b0f3f5db4a0e1f468021)
        ;

        
    
    
            var marker_ae9d7184235d6482d76dccb884cbdf1c = L.marker(
                [36.003504477925134, -78.93986341058513],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_022e4fa39a61661ed378b81ad3c17001 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_6e603f40bd5153f504cb4de3ab3792fa = $(`&lt;div id=&quot;html_6e603f40bd5153f504cb4de3ab3792fa&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Twinnies Cafe&lt;/div&gt;`)[0];
                popup_022e4fa39a61661ed378b81ad3c17001.setContent(html_6e603f40bd5153f504cb4de3ab3792fa);
            
        

        marker_ae9d7184235d6482d76dccb884cbdf1c.bindPopup(popup_022e4fa39a61661ed378b81ad3c17001)
        ;

        
    
    
            var marker_cf589075d0a4b3e3adb80479c570c7af = L.marker(
                [35.93888282121306, -78.96972026717717],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_5ee1b85e5535a830ebc30e88d96e24cf = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_7f9c3584f75c50f67f4b1b59af1406e8 = $(`&lt;div id=&quot;html_7f9c3584f75c50f67f4b1b59af1406e8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Sweet Bumpas Cakes&lt;/div&gt;`)[0];
                popup_5ee1b85e5535a830ebc30e88d96e24cf.setContent(html_7f9c3584f75c50f67f4b1b59af1406e8);
            
        

        marker_cf589075d0a4b3e3adb80479c570c7af.bindPopup(popup_5ee1b85e5535a830ebc30e88d96e24cf)
        ;

        
    
    
            var marker_d99b95ecc73418a5422ed19b3441b73b = L.marker(
                [35.972205677033976, -78.94823179401139],
                {
}
            ).addTo(map_f81c42e82786365fe81fe67debe51ac5);
        
    
        var popup_66f32d17f7c44aeb15b9b6f74d621446 = L.popup({
  &quot;maxWidth&quot;: &quot;100%&quot;,
});

        
            
                var html_275ba11eba2cc841360770f1a4394c0a = $(`&lt;div id=&quot;html_275ba11eba2cc841360770f1a4394c0a&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Saladelia Cafe &amp; Catering&lt;/div&gt;`)[0];
                popup_66f32d17f7c44aeb15b9b6f74d621446.setContent(html_275ba11eba2cc841360770f1a4394c0a);
            
        

        marker_d99b95ecc73418a5422ed19b3441b73b.bindPopup(popup_66f32d17f7c44aeb15b9b6f74d621446)
        ;

        
    
&lt;/script&gt;
&lt;/html&gt;" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div></div></div>
</div>
</section>
<section id="produce-a-graph-or-network">
<h2>Produce a graph (or network)<a class="headerlink" href="#produce-a-graph-or-network" title="Link to this heading">#</a></h2>
<p>We will now produce a network using roads, sidewalks, and trails features in OSM. The <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/osmnx.html#module-osmnx.graph"><code class="docutils literal notranslate"><span class="pre">graph</span></code></a> module in <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code> automatically process a network topology from raw OpenStreetMap data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <strong>network</strong> is also known as a <strong>graph</strong> in mathematics.</p>
</div>
<a class="reference internal image-reference" href="../../_images/graph_elements.png"><img alt="../../_images/graph_elements.png" class="align-center" src="../../_images/graph_elements.png" style="width: 500px;" /></a>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">graph_from_point</span></code> function which accepts a <strong>point</strong> (as lat/lon), a <strong>distance</strong> (in meters), and a <strong>network type</strong>. The options for <strong>network type</strong> are available in <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/osmnx.html#osmnx.graph.graph_from_point">documentation</a> and include <code class="docutils literal notranslate"><span class="pre">&quot;all_private&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;all&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;bike&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;drive&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;drive_service&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;walk&quot;</span></code>. We choose a distance of <strong>2 miles</strong> and the <code class="docutils literal notranslate"><span class="pre">walk</span></code> option since we are interested in cafes that are walkable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define coordinates of Grainger Hall</span>
<span class="n">lat_lon</span> <span class="o">=</span> <span class="p">(</span><span class="mf">36.0046</span><span class="p">,</span> <span class="o">-</span><span class="mf">78.9426</span><span class="p">)</span>

<span class="c1"># Define walkable street network 2 mile around Grainger Hall</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_point</span><span class="p">(</span><span class="n">lat_lon</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">3200</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;walk&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see what the graph looks like…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot map</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">node_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                             <span class="n">node_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3a81a77ac9ed367da5707aec060e7472de535eabd0971734c282046679c75818.png" src="../../_images/3a81a77ac9ed367da5707aec060e7472de535eabd0971734c282046679c75818.png" />
</div>
</div>
<p>The first thing to note is that the network structure consists of <strong>nodes</strong> (dots) and <strong>edges</strong> (lines). Nodes represent objects while edges represent the relationship between those objects.</p>
<p>Since our network represents transport infrastructure, nodes represent intersections/dead-ends and edges represent the street segments that link them. If we were studying social relationships between Facebook users, nodes would represent users and edges would represent relationships between them (e.g. friendships or group memberships).</p>
<p>Also note that the graph is <a class="reference external" href="https://networkx.org/documentation/stable/reference/classes/multidigraph.html"><code class="docutils literal notranslate"><span class="pre">MultiDiGraph</span> <span class="pre">NetworkX</span></code></a> object. <code class="docutils literal notranslate"><span class="pre">Multi</span></code> means that multiple edges are allowed between any pair of nodes. <code class="docutils literal notranslate"><span class="pre">Di</span></code> stands for <strong>directed</strong> which means that all our edges are directional. Bidirectional streets are therefore represented with <strong>two edges</strong> (with identical geometries): one from node 1 to node 2 and another from 2 to 1, to represent both possible directions of flow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>networkx.classes.multidigraph.MultiDiGraph
</pre></div>
</div>
</div>
</div>
<p>We can call the <a class="reference external" href="https://networkx.org/documentation/stable/reference/generated/networkx.classes.function.info.html"><code class="docutils literal notranslate"><span class="pre">info</span></code></a> function on the graph to see how many nodes and edges it contains.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nodes:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Edges:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nodes: 11160
Edges: 32300
</pre></div>
</div>
</div>
</div>
</section>
<section id="reproject-network">
<h2>Reproject network<a class="headerlink" href="#reproject-network" title="Link to this heading">#</a></h2>
<p>Once we have produced our graph (or network, it is good practice to <strong>reproject</strong> it to UTM coorindates so we can work in SI units (i.e. meters) instead of degrees. The <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/osmnx.html#osmnx.projection.project_graph"><code class="docutils literal notranslate"><span class="pre">graph_project</span></code></a> function can be used to reproject the graph. The docs note that if the <code class="docutils literal notranslate"><span class="pre">to_crs</span></code> argument is set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, the graph is projected to the UTM coordinate system for the UTM zone in which the graph’s centroid lies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert to graph</span>
<span class="n">graph_proj</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">project_graph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">to_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-points-of-interest">
<h2>Define points of interest<a class="headerlink" href="#define-points-of-interest" title="Link to this heading">#</a></h2>
<p>Next we define the centroid locations of Grainger Hall and our cafes, making sure that they are in the same projection as our graph (i.e. UTM Zone 17N or EPSG:32617).</p>
<p>We can find Grainger Hall in our original OSM building data using string matching. Note that we can use <a class="reference external" href="https://www.openstreetmap.org/"><code class="docutils literal notranslate"><span class="pre">https://www.openstreetmap.org/</span></code></a> to find the name of specific buildings.</p>
<a class="reference internal image-reference" href="../../_images/environment-hall.png"><img alt="../../_images/environment-hall.png" class="align-center" src="../../_images/environment-hall.png" style="width: 800px;" /></a>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get coordinates of Grainger Hall</span>
<span class="n">grainger_hall</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Environment Hall&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Reproject to UTM Zone 17N</span>
<span class="n">grainger_hall</span> <span class="o">=</span> <span class="n">grainger_hall</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:32617&#39;</span><span class="p">)</span>
<span class="n">cafes</span> <span class="o">=</span> <span class="n">cafes</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:32617&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Compute centroids…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grainger_hall</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grainger_hall</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">centroid</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">Polygon</span> <span class="k">else</span> <span class="p">(</span>
  <span class="n">x</span><span class="o">.</span><span class="n">centroid</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">MultiPolygon</span> <span class="k">else</span> <span class="n">x</span><span class="p">))</span>

<span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">centroid</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">Polygon</span> <span class="k">else</span> <span class="p">(</span>
  <span class="n">x</span><span class="o">.</span><span class="n">centroid</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">MultiPolygon</span> <span class="k">else</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Format the centroids as a <strong>list</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To begin with we will only compute the shortest distance between Grainger Hall and the <strong>first</strong> cafe in our <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get x and y coordinates of Grainger Hall</span>
<span class="n">orig_xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">grainger_hall</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grainger_hall</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Get x and y coordinates of the first cafe</span>
<span class="n">target_xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-shortest-path-between-points">
<h2>Find the shortest path between points<a class="headerlink" href="#find-the-shortest-path-between-points" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/osmnx.html#module-osmnx.distance"><code class="docutils literal notranslate"><span class="pre">distance</span></code></a> module in <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code> contains functions for calculating distances, shortest paths, and finding nearest node/edge(s) to point(s). Since the coordinates of our points are unlikely to exactly align with one of the nodes, we first have to find the nearest node to our points using the <code class="docutils literal notranslate"><span class="pre">nearest_nodes</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the node in the graph that is closest to the origin point</span>
<span class="n">orig_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">orig_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">orig_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">return_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Find the node in the graph that is closest to the target point</span>
<span class="n">target_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">target_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">target_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">return_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can compute the shortest distance between our two points using the <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/shortest_paths.html"><code class="docutils literal notranslate"><span class="pre">shortest_path</span></code></a> functions available from <code class="docutils literal notranslate"><span class="pre">NetworkX</span></code>. The <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.shortest_paths.generic.shortest_path.html#networkx.algorithms.shortest_paths.generic.shortest_path"><code class="docutils literal notranslate"><span class="pre">shortest_path</span></code></a> function returns a list of nodes along the shortest path, and the <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.shortest_paths.generic.shortest_path_length.html#networkx.algorithms.shortest_paths.generic.shortest_path_length"><code class="docutils literal notranslate"><span class="pre">shortest_path_length</span></code></a> function returns the length of this path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">weight</span></code> argument defines the edge attribute to minimize when solving shortest path. In our case, we would like the <strong>shortest distance</strong> so we choose <code class="docutils literal notranslate"><span class="pre">length</span></code>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the shortest path</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">orig_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">orig_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shortest path distance = </span><span class="si">{t:.1f}</span><span class="s2"> km.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">length</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shortest path distance = 2.5 km.
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">route</span></code> variable contains a list of the nodes constituting the shortest path between the two points. It can plotted using the <code class="docutils literal notranslate"><span class="pre">plot_route_folium</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the shortest path using folium</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_graph_route</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">route_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">route_linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">route_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                             <span class="n">node_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                             <span class="n">node_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/50626c5ea0206f7e824601f440d7762f62d83172b10f09dc7a0e45a6af22c954.png" src="../../_images/50626c5ea0206f7e824601f440d7762f62d83172b10f09dc7a0e45a6af22c954.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 800x800 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-distance-to-many-cafes">
<h2>Find the distance to many cafes<a class="headerlink" href="#find-the-distance-to-many-cafes" title="Link to this heading">#</a></h2>
<p>To compute the shortest distance from Grainger Hall to <strong>all</strong> the cafes we can make a list of all target locations, find the nearest node for each target location, and loop over them like so…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

<span class="n">target_nodes</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">target_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">target_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">return_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">routes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_nodes</span><span class="p">)):</span>
    <span class="n">routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">orig_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">))</span>
    <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">orig_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the shortest path using folium</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_graph_route</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">routes</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">route_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">route_linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">route_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                             <span class="n">node_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                             <span class="n">node_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a398937edfdcc19f03c2d74f68c847e6bf3907c7481b72c7950f634e55a1caf5.png" src="../../_images/a398937edfdcc19f03c2d74f68c847e6bf3907c7481b72c7950f634e55a1caf5.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 800x800 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
</div>
</div>
<p>Make a list of the nearest ten cafes from Grainger Hall.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;distance_km&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">cafes</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;distance_km&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;distance_km&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>distance_km</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>Twinnies Cafe</td>
      <td>0.430875</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Panaderia La Loma</td>
      <td>2.283123</td>
    </tr>
    <tr>
      <th>0</th>
      <td>9th Street Coffee and Juice Bar</td>
      <td>2.526072</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Francesca's Dessert Cafe</td>
      <td>2.526072</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mad Hatter's Bake Shop</td>
      <td>2.578312</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Baby Scratch</td>
      <td>3.399804</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Cocoa Cinnamon</td>
      <td>3.461331</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Miel Bon Bons I Fine Chocolate &amp; Macarons l Ex...</td>
      <td>3.549380</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Cocoa Cinnamon</td>
      <td>4.028373</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Starbucks</td>
      <td>4.277146</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Finally, we can convert distance to time using an assumed walking speed of 4.5 kph (or 2.8 mph).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">travel_speed_minutes</span> <span class="o">=</span> <span class="mf">4.5</span> <span class="o">/</span> <span class="mi">60</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;time_minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;distance_km&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">travel_speed_minutes</span>
<span class="n">cafes</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;distance_km&#39;</span><span class="p">,</span> <span class="s1">&#39;time_minutes&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;distance_km&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>distance_km</th>
      <th>time_minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>Twinnies Cafe</td>
      <td>0.430875</td>
      <td>5.744994</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Panaderia La Loma</td>
      <td>2.283123</td>
      <td>30.441644</td>
    </tr>
    <tr>
      <th>0</th>
      <td>9th Street Coffee and Juice Bar</td>
      <td>2.526072</td>
      <td>33.680957</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Francesca's Dessert Cafe</td>
      <td>2.526072</td>
      <td>33.680957</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mad Hatter's Bake Shop</td>
      <td>2.578312</td>
      <td>34.377492</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Baby Scratch</td>
      <td>3.399804</td>
      <td>45.330724</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Cocoa Cinnamon</td>
      <td>3.461331</td>
      <td>46.151080</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Miel Bon Bons I Fine Chocolate &amp; Macarons l Ex...</td>
      <td>3.549380</td>
      <td>47.325063</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Cocoa Cinnamon</td>
      <td>4.028373</td>
      <td>53.711641</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Starbucks</td>
      <td>4.277146</td>
      <td>57.028607</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="isochrones">
<h2>Isochrones<a class="headerlink" href="#isochrones" title="Link to this heading">#</a></h2>
<p>Another way to approach this problem would be to find all the <strong>buildings</strong> that we would be prepared to walk to in a <strong>given time period</strong>, and then find all buildings labeled as cafes. This may be a more logical approach since we don’t have to rely on finding all the cafes at the start of the analysis - and we know some are likely to be missing. We can also visualize our results using an <a class="reference external" href="https://en.wikipedia.org/wiki/Isochrone_map"><strong>isochrone map</strong></a>, a popular type of map where each color represents an area accessible from a point within a certain time threshold.</p>
</section>
<section id="edge-and-node-attributes">
<h2>Edge and node attributes<a class="headerlink" href="#edge-and-node-attributes" title="Link to this heading">#</a></h2>
<p>To conduct this analysis, it is useful to spend a little more time thinking about the attributes of <strong>nodes</strong> and <strong>edges</strong> of the <code class="docutils literal notranslate"><span class="pre">MultiDiGraph</span></code> object that is produced by <code class="docutils literal notranslate"><span class="pre">OSMnx</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>networkx.classes.multidigraph.MultiDiGraph
</pre></div>
</div>
</div>
</div>
<p>We can explore the <strong>edge</strong> and <strong>node</strong> attributes easier if we convert the <code class="docutils literal notranslate"><span class="pre">MultiDiGraph</span></code> to a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>. We’ll have a look at the nodes first since they are a bit more intuitive. In our infrastructure network, nodes represent intersections/dead-ends,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>y</th>
      <th>x</th>
      <th>highway</th>
      <th>street_count</th>
      <th>junction</th>
      <th>geometry</th>
    </tr>
    <tr>
      <th>osmid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>170501915</th>
      <td>3.988635e+06</td>
      <td>684398.282096</td>
      <td>traffic_signals</td>
      <td>3</td>
      <td>NaN</td>
      <td>POINT (684398.282 3988634.57)</td>
    </tr>
    <tr>
      <th>7838622038</th>
      <td>3.988598e+06</td>
      <td>684405.136122</td>
      <td>NaN</td>
      <td>3</td>
      <td>NaN</td>
      <td>POINT (684405.136 3988597.578)</td>
    </tr>
    <tr>
      <th>170505304</th>
      <td>3.988816e+06</td>
      <td>684367.392224</td>
      <td>traffic_signals</td>
      <td>3</td>
      <td>NaN</td>
      <td>POINT (684367.392 3988815.727)</td>
    </tr>
    <tr>
      <th>170501953</th>
      <td>3.988373e+06</td>
      <td>683587.447833</td>
      <td>NaN</td>
      <td>3</td>
      <td>NaN</td>
      <td>POINT (683587.448 3988373.466)</td>
    </tr>
    <tr>
      <th>170501960</th>
      <td>3.988348e+06</td>
      <td>683578.019697</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>POINT (683578.02 3988347.92)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The <strong>nodes</strong> <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> is indexed by an <code class="docutils literal notranslate"><span class="pre">osmid</span></code> which provides a unique identifier for each node.</p></li>
<li><p>We then have <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code> columns that represent location in <strong>UTM Zone 17 N</strong> coordinates (since we reprojected earlier). The <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column also looks to be in UTM Zone 17 N so we know we are working in meters, not degrees.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">street_count</span></code> column provides the number of street segments connected to each node. The <code class="docutils literal notranslate"><span class="pre">highway</span></code> column provides the type of intersection.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;highway&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;traffic_signals&#39;, nan, &#39;crossing&#39;, &#39;turning_circle&#39;, &#39;stop&#39;,
       &#39;give_way&#39;, &#39;turning_loop&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="edges">
<h3>Edges<a class="headerlink" href="#edges" title="Link to this heading">#</a></h3>
<p>Edges represent street segments and there are a few more columns to interpret.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>osmid</th>
      <th>highway</th>
      <th>lanes</th>
      <th>maxspeed</th>
      <th>name</th>
      <th>oneway</th>
      <th>reversed</th>
      <th>length</th>
      <th>geometry</th>
      <th>service</th>
      <th>access</th>
      <th>bridge</th>
      <th>width</th>
      <th>ref</th>
      <th>junction</th>
      <th>tunnel</th>
    </tr>
    <tr>
      <th>u</th>
      <th>v</th>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">170501915</th>
      <th>7838622038</th>
      <th>0</th>
      <td>[639769914, 637002278]</td>
      <td>tertiary</td>
      <td>6</td>
      <td>35 mph</td>
      <td>Cole Mill Road</td>
      <td>False</td>
      <td>True</td>
      <td>37.710923</td>
      <td>LINESTRING (684398.282 3988634.57, 684403.754 ...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">170505304</th>
      <th>0</th>
      <td>[840015889, 637002258, 840015893, 840015895]</td>
      <td>tertiary</td>
      <td>4</td>
      <td>35 mph</td>
      <td>Cole Mill Road</td>
      <td>False</td>
      <td>True</td>
      <td>189.039181</td>
      <td>LINESTRING (684398.282 3988634.57, 684385.844 ...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[840015896, 840015890, 840015892, 637002262]</td>
      <td>tertiary</td>
      <td>4</td>
      <td>35 mph</td>
      <td>Cole Mill Road</td>
      <td>False</td>
      <td>False</td>
      <td>187.656841</td>
      <td>LINESTRING (684398.282 3988634.57, 684403.831 ...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">7838622038</th>
      <th>170731856</th>
      <th>0</th>
      <td>637002278</td>
      <td>tertiary</td>
      <td>6</td>
      <td>35 mph</td>
      <td>Cole Mill Road</td>
      <td>False</td>
      <td>True</td>
      <td>9.201632</td>
      <td>LINESTRING (684405.136 3988597.578, 684406.391...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5562830797</th>
      <th>0</th>
      <td>581368356</td>
      <td>service</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>121.790170</td>
      <td>LINESTRING (684405.136 3988597.578, 684386.355...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The <strong>edges</strong> <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> is indexed by <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> which represent the start and end nodes for the edge. The <code class="docutils literal notranslate"><span class="pre">key</span></code> attribute differentiates between parallel edges. In other words, two edges that are between the same two nodes but differ in other attributes.</p></li>
<li><p>Each edge has an <code class="docutils literal notranslate"><span class="pre">osmid</span></code> but, in this framework, it’s more convenient to work with the nodes at either end of the edge.</p></li>
<li><p>The columns <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">oneway</span></code>, <code class="docutils literal notranslate"><span class="pre">length</span></code> (in meters), <code class="docutils literal notranslate"><span class="pre">geometry</span></code>, <code class="docutils literal notranslate"><span class="pre">bridge</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">junction</span></code>, and <code class="docutils literal notranslate"><span class="pre">tunnel</span></code> are self-explanatory.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">highway</span></code> column is provides the type of street segment (e.g. residential, footway, path).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have to use a <strong>for loop</strong> to get the unique values because there some roads are labeled more than once.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unique_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;highway&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
        <span class="n">unique_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;tertiary&#39;, &#39;service&#39;, &#39;residential&#39;, &#39;footway&#39;, &#39;secondary&#39;, &#39;primary&#39;, &#39;primary_link&#39;, [&#39;primary_link&#39;, &#39;service&#39;], [&#39;path&#39;, &#39;footway&#39;], [&#39;residential&#39;, &#39;footway&#39;], &#39;unclassified&#39;, [&#39;footway&#39;, &#39;service&#39;], &#39;secondary_link&#39;, [&#39;residential&#39;, &#39;service&#39;], &#39;tertiary_link&#39;, [&#39;steps&#39;, &#39;service&#39;], [&#39;residential&#39;, &#39;path&#39;, &#39;service&#39;], [&#39;path&#39;, &#39;service&#39;, &#39;residential&#39;], &#39;path&#39;, [&#39;path&#39;, &#39;residential&#39;], [&#39;residential&#39;, &#39;track&#39;], [&#39;path&#39;, &#39;service&#39;], [&#39;steps&#39;, &#39;footway&#39;], [&#39;residential&#39;, &#39;path&#39;], [&#39;residential&#39;, &#39;footway&#39;, &#39;service&#39;], &#39;track&#39;, &#39;steps&#39;, &#39;living_street&#39;, [&#39;secondary&#39;, &#39;secondary_link&#39;], [&#39;service&#39;, &#39;unclassified&#39;], [&#39;tertiary&#39;, &#39;unclassified&#39;], [&#39;path&#39;, &#39;steps&#39;, &#39;service&#39;], [&#39;secondary&#39;, &#39;tertiary&#39;], [&#39;path&#39;, &#39;footway&#39;, &#39;track&#39;], [&#39;secondary&#39;, &#39;service&#39;], &#39;pedestrian&#39;, [&#39;residential&#39;, &#39;unclassified&#39;], [&#39;footway&#39;, &#39;unclassified&#39;], [&#39;residential&#39;, &#39;primary&#39;], [&#39;residential&#39;, &#39;tertiary&#39;], [&#39;path&#39;, &#39;track&#39;], [&#39;footway&#39;, &#39;service&#39;, &#39;corridor&#39;], [&#39;unclassified&#39;, &#39;tertiary&#39;], [&#39;path&#39;, &#39;steps&#39;]]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">service</span></code> column is provides the type of service road (e.g. driveway, alley).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unique_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;service&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
        <span class="n">unique_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nan, &#39;parking_aisle&#39;, &#39;alley&#39;, &#39;driveway&#39;, [&#39;driveway&#39;, &#39;parking_aisle&#39;], &#39;drive-through&#39;, [&#39;drive-through&#39;, &#39;parking_aisle&#39;]]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">access</span></code> column is represents accessibility of the street.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;access&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([nan, &#39;yes&#39;, &#39;permissive&#39;, &#39;customers&#39;, &#39;no&#39;, &#39;destination&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We won’t use most of these columns in this demo but they could be very useful for further analysis.</p>
<p>Another way to access the edge and node attributes is to use the <code class="docutils literal notranslate"><span class="pre">list</span></code> built-in function on the <code class="docutils literal notranslate"><span class="pre">data()</span></code> attribute. Then list the <code class="docutils literal notranslate"><span class="pre">dict_keys</span></code> of the associated object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">graph_proj</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;osmid&#39;,
 &#39;highway&#39;,
 &#39;lanes&#39;,
 &#39;maxspeed&#39;,
 &#39;name&#39;,
 &#39;oneway&#39;,
 &#39;reversed&#39;,
 &#39;length&#39;,
 &#39;geometry&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="add-an-edge-attribute">
<h2>Add an edge attribute<a class="headerlink" href="#add-an-edge-attribute" title="Link to this heading">#</a></h2>
<p>To compute the distance we can travel in a given time period, we need to know the time taken to walk along each street segment or edge. Since we know the length of each edge and our travel speed, we can compute this attribute like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">travel_speed</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">meters_per_minute</span> <span class="o">=</span> <span class="n">travel_speed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">60</span>  <span class="c1"># km per hour to m per minute</span>

<span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">graph_proj</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">():</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">meters_per_minute</span>
</pre></div>
</div>
</div>
</div>
<p>Now when we print a single value from our edges dataset, we have a new attribute called <code class="docutils literal notranslate"><span class="pre">time</span></code> which is the number of minutes to travel along the edge.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">graph_proj</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(170501915,
 7838622038,
 {&#39;osmid&#39;: [639769914, 637002278],
  &#39;highway&#39;: &#39;tertiary&#39;,
  &#39;lanes&#39;: &#39;6&#39;,
  &#39;maxspeed&#39;: &#39;35 mph&#39;,
  &#39;name&#39;: &#39;Cole Mill Road&#39;,
  &#39;oneway&#39;: False,
  &#39;reversed&#39;: True,
  &#39;length&#39;: 37.710923381159986,
  &#39;geometry&#39;: &lt;LINESTRING (684398.282 3988634.57, 684403.754 3988607.593, 684405.136 39885...&gt;,
  &#39;time&#39;: 0.4525310805739199})
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-all-nodes-within-given-radius">
<h2>Find all nodes within given radius<a class="headerlink" href="#find-all-nodes-within-given-radius" title="Link to this heading">#</a></h2>
<p>We can find all the nodes within a given radius using the <a class="reference external" href="https://networkx.org/documentation/stable/reference/generated/networkx.generators.ego.ego_graph.html?highlight=ego_graph"><code class="docutils literal notranslate"><span class="pre">ego_graph</span></code></a> function in <code class="docutils literal notranslate"><span class="pre">NetworkX</span></code>. The first two arguments include the original graph (i.e. our Durham network) and a single node which, in our case, is Grainger Hall. The last two arguments are the <code class="docutils literal notranslate"><span class="pre">radius</span></code> within which to include neighboring nodes and <code class="docutils literal notranslate"><span class="pre">distance</span></code> which detemines the edge attribute to use. We will use the <code class="docutils literal notranslate"><span class="pre">time</span></code> attribute we just produced but note that we could also use <code class="docutils literal notranslate"><span class="pre">length</span></code> if we were interested only in distance.</p>
<p>As a test we will set <code class="docutils literal notranslate"><span class="pre">radius</span></code> to <strong>10</strong> which is equivalent to 10 <strong>minutes</strong> of traveling by foot. But note that if <code class="docutils literal notranslate"><span class="pre">distance</span></code> was set to <code class="docutils literal notranslate"><span class="pre">length</span></code>, this would be 10 <strong>meters</strong> of traveling by foot (i.e. not very far).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subgraph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">ego_graph</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">orig_node</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">subgraph</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/01fdd9028876aa178c52f1398130ebea1c871b3a2a23c62be5eabb723d63c708.png" src="../../_images/01fdd9028876aa178c52f1398130ebea1c871b3a2a23c62be5eabb723d63c708.png" />
</div>
</div>
</section>
<section id="produce-isochrone-map">
<h2>Produce isochrone map<a class="headerlink" href="#produce-isochrone-map" title="Link to this heading">#</a></h2>
<p>We now have all the components to calculate the nodes that are within certain walking times from Grainger Hall. We will use walking times of 5 to 45 minutes in 5-minute intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trip_times</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>  <span class="c1"># in minutes</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we will define a color for each trip time (or isochrone).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get one color for each isochrone</span>
<span class="n">iso_colors</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trip_times</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This next bit gets a little hairy but basically we will assign each node a color based on the travel time from Grainger Hall. We found this code from <a class="reference external" href="https://github.com/gboeing/osmnx-examples/blob/main/notebooks/13-isolines-isochrones.ipynb">here</a>. We’re not sure we could have written this ourselves but it’s perfectly OK to appropriate someone else’s code if it works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># color the nodes according to isochrone then plot the street network</span>
<span class="n">node_colors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">trip_time</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">trip_times</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">iso_colors</span><span class="p">):</span>
    <span class="n">subgraph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">ego_graph</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">orig_node</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">trip_time</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="n">node_colors</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

<span class="n">nc</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_colors</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_colors</span> <span class="k">else</span> <span class="s2">&quot;none&quot;</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph_proj</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
<span class="n">ns</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_colors</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph_proj</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can plot our colored nodes onto the original graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">ns</span><span class="p">,</span> <span class="n">node_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/28e8f5cc6d309a4519b255806fca36ddaed0c7e2d9500d14bc9a67df53f38b4c.png" src="../../_images/28e8f5cc6d309a4519b255806fca36ddaed0c7e2d9500d14bc9a67df53f38b4c.png" />
</div>
</div>
<p>This looks great but is of limited use since the buildings that we want to travel to are not necessarily associated with nodes. It would be more convenient to convert this data into polygons which we could use to intersect buildings (or points) of interest.</p>
</section>
<section id="isochrone-polygons">
<h2>Isochrone polygons<a class="headerlink" href="#isochrone-polygons" title="Link to this heading">#</a></h2>
<p>Again, we found this code from <a class="reference external" href="https://github.com/gboeing/osmnx-examples/blob/main/notebooks/13-isolines-isochrones.ipynb">here</a>, don’t worry if you don’t understand it. We first define a function to make the isochrone polygons from positions of the nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_iso_polys</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_buff</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">node_buff</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">infill</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">isochrone_polys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">trip_time</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">trip_times</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">subgraph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">ego_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">orig_node</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">trip_time</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

        <span class="n">node_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="n">nodes_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()},</span> <span class="n">geometry</span><span class="o">=</span><span class="n">node_points</span><span class="p">)</span>
        <span class="n">nodes_gdf</span> <span class="o">=</span> <span class="n">nodes_gdf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="n">edge_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n_fr</span><span class="p">,</span> <span class="n">n_to</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">nodes_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n_fr</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">nodes_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n_to</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>
            <span class="n">edge_lookup</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">n_fr</span><span class="p">,</span> <span class="n">n_to</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span>  <span class="n">LineString</span><span class="p">([</span><span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">edge_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_lookup</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">nodes_gdf</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">node_buff</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">edge_lines</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">edge_buff</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span>
        <span class="n">all_gs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">new_iso</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">all_gs</span><span class="p">)</span><span class="o">.</span><span class="n">union_all</span><span class="p">()</span>
        
        <span class="c1"># try to fill in surrounded areas so shapes will appear solid and blocks without white space inside them</span>
        <span class="k">if</span> <span class="n">infill</span><span class="p">:</span>
            <span class="n">new_iso</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">new_iso</span><span class="o">.</span><span class="n">exterior</span><span class="p">)</span>
        <span class="n">isochrone_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_iso</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">isochrone_polys</span>
</pre></div>
</div>
</div>
</div>
<p>Next we will call the function…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isochrone_polys</span> <span class="o">=</span> <span class="n">make_iso_polys</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">edge_buff</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">node_buff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">infill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">iso_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">isochrone_polys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And plot!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">graph_proj</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edge_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                        <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edge_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">iso_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">iso_colors</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/13e517b21c8a864bab41a89f2d810ad02a2d635c7a61956199c5115f5d0a9220.png" src="../../_images/13e517b21c8a864bab41a89f2d810ad02a2d635c7a61956199c5115f5d0a9220.png" />
</div>
</div>
<p>Finally, let’s intersect these polygons with our cafes to see which are within a given travel time. The <code class="docutils literal notranslate"><span class="pre">isochrone_polys</span></code> are actually in reverse order so the first polygon represents the longest travel time (i.e. 45 minutes) and the last polygon represents the shortest travel time (i.e. 5 minutes)</p>
<p><code class="docutils literal notranslate"><span class="pre">trip_times</span> <span class="pre">=</span> <span class="pre">[5,</span> <span class="pre">10,</span> <span class="pre">15,</span> <span class="pre">20,</span> <span class="pre">25,</span> <span class="pre">30,</span> <span class="pre">35,</span> <span class="pre">40,</span> <span class="pre">45]</span></code></p>
<p>So to find which cafes are within 35 minutes of walking we would use the <strong>third</strong> item in the index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;35-minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cafes</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">isochrone_polys</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">cafes</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;time_minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;distance_km&#39;</span><span class="p">]][</span><span class="n">cafes</span><span class="p">[</span><span class="s1">&#39;35-minutes&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>time_minutes</th>
      <th>distance_km</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9th Street Coffee and Juice Bar</td>
      <td>33.680957</td>
      <td>2.526072</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mad Hatter's Bake Shop</td>
      <td>34.377492</td>
      <td>2.578312</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Francesca's Dessert Cafe</td>
      <td>33.680957</td>
      <td>2.526072</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Panaderia La Loma</td>
      <td>30.441644</td>
      <td>2.283123</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Twinnies Cafe</td>
      <td>5.744994</td>
      <td>0.430875</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="acknowledgments">
<h2>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Link to this heading">#</a></h2>
<p>This demo was inspired by material provided from the <a class="reference external" href="https://networkx.org/documentation/stable/index.html">NetworkX</a> and <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/">OSMnx</a> docs as well as the <a class="reference external" href="https://github.com/gboeing/osmnx-examples">osmnx-examples</a> produced by <a class="reference external" href="https://geoffboeing.com/">Geoff Boeing</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lectures/unit1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../activities/week2/activity-02.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Activity 2</p>
      </div>
    </a>
    <a class="right-next"
       href="../../labs/week3/assignment3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Assignment 3</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#openstreetmap">OpenStreetMap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-data">Network data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-network-data">Types of network data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx"><code class="docutils literal notranslate"><span class="pre">NetworkX</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#osmnx"><code class="docutils literal notranslate"><span class="pre">OSMnx</span> </code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-osm-data">Retrieve OSM data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#produce-a-graph-or-network">Produce a graph (or network)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproject-network">Reproject network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-points-of-interest">Define points of interest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-shortest-path-between-points">Find the shortest path between points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-distance-to-many-cafes">Find the distance to many cafes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isochrones">Isochrones</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-and-node-attributes">Edge and node attributes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nodes">Nodes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edges">Edges</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-an-edge-attribute">Add an edge attribute</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-all-nodes-within-given-radius">Find all nodes within given radius</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#produce-isochrone-map">Produce isochrone map</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isochrone-polygons">Isochrone polygons</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgments">Acknowledgments</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Johnny Ryan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>